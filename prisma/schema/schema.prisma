generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("MYSQL_URI")
}

model User {
  id            String          @id @default(uuid(7))
  name          String          @db.VarChar(100)
  surname       String          @db.VarChar(100)
  age           Int
  email         String          @unique @db.VarChar(150)
  password      String          @db.VarChar(150)
  phone         String?         @db.VarChar(100)
  gender        GenderEnum?
  photo         String?         @db.VarChar(100)
  role_id       Int
  region_id     Int
  city          String          @db.VarChar(100)
  account_type  AccountTypeEnum @default(basic)
  balance       Int             @default(0)
  currency      CurrencyEnum    @default(UAH)
  premium_since DateTime?
  premium_until DateTime?
  is_verified   Boolean         @default(false)
  is_active     Boolean         @default(false)
  is_deleted    Boolean         @default(false)
  created_at    DateTime        @default(now())
  updated_at    DateTime        @updatedAt
  role          Role            @relation(references: [id], fields: [role_id])
  region        Region          @relation(references: [id], fields: [region_id])
  token         Token[]

  @@map("users")
}

enum AccountTypeEnum {
  basic
  premium
}

enum CurrencyEnum {
  UAH
  USD
  EUR
}

enum GenderEnum {
  male
  female
}

model Region {
  id   Int    @id @default(autoincrement())
  name String @db.VarChar(100)
  code String @db.VarChar(50)
  User User[]

  @@map("regions")
}

model Role {
  id             Int              @id @default(autoincrement())
  name           String           @db.VarChar(100)
  User           User[]
  RolePermission RolePermission[]

  @@map("roles")
}

model Permission {
  id             Int              @id @default(autoincrement())
  name           String           @db.VarChar(50)
  RolePermission RolePermission[]

  @@map("permissions")
}

model RolePermission {
  role_id       Int
  permission_id Int
  role          Role       @relation(references: [id], fields: [role_id])
  permission    Permission @relation(references: [id], fields: [permission_id])

  @@id([role_id, permission_id])
}

model Token {
  id            String   @id @default(uuid(7))
  user_id       String
  access_token  String   @db.VarChar(512)
  refresh_token String   @db.VarChar(512)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  user          User     @relation(references: [id], fields: [user_id])

  @@map("tokens")
}

model Statistic {
  id                    String  @id @default(uuid(7))
  total_views           Int     @default(0)
  views_per_day         Int     @default(0)
  views_per_week        Int     @default(0)
  views_per_month       Int     @default(0)
  average_region_price  Decimal @db.Decimal(10, 2)
  average_country_price Decimal @db.Decimal(10, 2)

  @@map("statistics")
}
